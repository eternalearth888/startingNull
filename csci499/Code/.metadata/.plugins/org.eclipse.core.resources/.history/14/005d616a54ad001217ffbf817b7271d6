package gui;

import java.awt.FlowLayout;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.regex.Pattern;

import javax.swing.*;
import javax.swing.text.AttributeSet;
import javax.swing.text.BadLocationException;
import javax.swing.text.Document;
import javax.swing.text.PlainDocument;

import game.Game;

public class ControlPanel extends JPanel {
	
	private Game play;
	
	private JTextField numTargetsBox;
	
	private JButton playButton;
	private JButton launchButton;
	private JButton resetButton;
	
	private JSlider powerSlider;
	private JSlider angleSlider;
	
	private JLabel numTargetsLabel;
	private JLabel powerBox;
	private JLabel angleBox;
	private JLabel timerLabel;
	
	public ControlPanel(Game g) {
		play = g;
		
		setLayout(new FlowLayout(FlowLayout.LEFT));
		
		//	Setup Panel
		JPanel setupPanel = new JPanel();
		setupPanel.setLayout(new GridBagLayout());
		GridBagConstraints panel = new GridBagConstraints();
		
		//	Create Elements
		numTargetsLabel = new JLabel("Number of Pokemon ");
		numTargetsBox = new NumericTextField("5", 3);
		playButton = new JButton("Play");
		resetButton = new JButton("Reset");
		
		// Add Elements to Panel
		panel.fill = GridBagConstraints.HORIZONTAL;
		panel.gridx = 0;
		panel.gridy = 0;
	}
	
	class NumericTextField extends JTextField
	{

	    public NumericTextField(String string, int i) {
			super(string, i);
		}

		@Override
	    protected Document createDefaultModel()
	    {
	        return new NumericDocument();
	    }

	    private class NumericDocument extends PlainDocument
	    {
	        // The regular expression to match input against (zero or more digits)
	        private final Pattern DIGITS = Pattern.compile("\\d*");

	        @Override
	        public void insertString(int offs, String str, AttributeSet a) throws BadLocationException
	        {
	            // Only insert the text if it matches the regular expression
	            if (str != null && DIGITS.matcher(str).matches())
	                super.insertString(offs, str, a);
	        }
	    }
	}
	
	private class ControlButtonListener extends AbstractAction {
		@Override
		public void actionPerformed(ActionEvent e) {
			
			JButton source = (JButton)e.getSource();
			if( source == genTargetsButton ) {
				String number = numTargetsBox.getText();
				try {
					int n = Integer.parseInt(number);
					if( n > 50 || n == 0){
						throw( new NumberFormatException());
					}
					world.generateTargets(n);
				} catch(NumberFormatException ex) {
					JOptionPane.showMessageDialog(null,
							"Error: Please enter a number between 1 and 50.", "Error",
							JOptionPane.ERROR_MESSAGE);
				}
			} else if( source == clearTargetsButton ) {
				world.clearTargets();
			} else if( source == launchButton ) {
				world.launch();				
			}
			world.repaint();
		}

	}

	private class SliderChangeListener implements ChangeListener {
		@Override
		public void stateChanged(ChangeEvent e) {
			JSlider source = (JSlider)e.getSource();
			if( source == powerSlider ) {
				world.getLauncher().setPower(source.getValue());
				powerBox.setText(String.valueOf(source.getValue()));
			} else if( source == angleSlider ) {
				world.getLauncher().setAngle(source.getValue());
				angleBox.setText(String.valueOf(source.getValue()));
			}
			world.repaint();
		}		
	}
	
//	Timer timer = new Timer(1000, new TimerListener());
//
//	class TimerListener implements ActionListener {
//		int elapsedSeconds = 60;
//		
//		public void actionPerformed(ActionEvent evt) {
//			elapsedSeconds--;
//			timerLabel.setText(elapsedSeconds);
//			
//			if (elapsedSeconds == 0) {
//				timer.stop();
//			}
//			
//		}
//	}
}
